<html>
	<head>
		<meta charset="UTF-8">
		<title>Sanatlium</title>
		<link rel="stylesheet" type="text/css" href="Sanatlium.css">
		<script type="text/javascript" src="jquery-1.4.1.min.js"></script>
		<script type="text/javascript" src="jquery.gpkey-0.1.min.js"></script>
		<script type="text/python">
			import SanatliumCore
			api_handler = SanatliumCore.TwitterAPIHandler()
		</script>
		<script type="text/javascript">
			jQuery(function(){
				//var
				var in_reply_to_id = "";
				
				//load last 50 Home TimeLine
				jQuery("#timeline").prepend(api_handler.get_tl(50));
				
				//set timeline div size
				var windowheight = jQuery(window).height();
				var postformheight = jQuery("#post_form").innerHeight();
				jQuery("#timeline").height(windowheight-postformheight-33);
				
				// set UserStreamings Event Lisetener
				setInterval(function(){
					jQuery("#timeline").prepend(api_handler.check_que());
				} ,500);
				
				
				//set UI Event Handler
				//POST button
				jQuery("#post_button").click(function(){
					if (in_reply_to_id){
						api_handler.update(jQuery("#post_status").val() ,in_reply_to_id);
					}else{
						api_handler.update(jQuery("#post_status").val());
					}
					jQuery("#post_status").val("");
					in_reply_to_id = "";
				});
				//reply
				jQuery(".tweet").live("click",function(){
					var getAcount = jQuery(this).find(".acountname").text();
					jQuery("#post_status").text(getAcount);
					jQuery("#post_status").focus();
					in_reply_to_id = jQuery(this).attr("id");
					var getAcount ="";
				});
				/*
				//Unofficial RT
				jQuery(".tweet").live("click",function(){
					var getAcount = jQuery(this).find(".acountname").text();
					var getText =jQuery(this).find(".acounttext").text();
					jQuery("#post_status").text(" RT "+getAcount+": "+getText);
					jQuery("#post_status").focus();
					var getAcount ="";
				});
				*/
				/*
				//create favorite
				jQuery(".tweet").live("click",function(){
					api_handler.create_favorite(jQuery(this).attr("id"));
					alert("favarited");
				});
				*/
				
				//check if mouse cursor on timeline
				jQuery("#timeline").mouseover(function(){
					jQuery(this).focus();
				});
				
				//display string length of post_form
				jQuery("#post_status").bind("change keyup",function(){
					var WriLeng = jQuery(this).val().length;
					var Leng = 140 - WriLeng;
					jQuery("#textcount").text(Leng);
					if(Leng < 0){
						jQuery("#textcount").css("color","red");
					}else{
						jQuery("#textcount").css("color","#000");
					}
				});
				
				//set Window Resize Event Handler
				jQuery(window).resize(function(){
					windowheight = jQuery(window).height();
					jQuery("#timeline").height(windowheight-postformheight-33);
				});
				
				//set Key Config
				jQuery("#post_form").gpKey("down" ,{
					"^enter":function(){
						if (in_reply_to_id){
							api_handler.update(jQuery("#post_status").val() ,in_reply_to_id);
						}else{
							api_handler.update(jQuery("#post_status").val());
						}
						jQuery("#post_status").val("");
						in_reply_to_id = "";
					},
				});
			});
		</script>
	</head>
	
	<body>
		<div id="post_form">
			<textarea id="post_status" rows="4"></textarea><br />
			<b id="textcount">140</b><button id="post_button">POST</button>
		</div>
		<hr />
		<div id="timeline">
		</div>
	</body>
</html>